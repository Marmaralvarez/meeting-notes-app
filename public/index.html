<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Notes AI Assistant</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8faf6;
            color: #1f2937;
            line-height: 1.6;
        }
        
        .custom-file-input {
            position: relative;
            overflow: hidden;
            display: inline-block;
            cursor: pointer;
        }
        
        .custom-file-input input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .ai-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: #6b7c4e;
            margin-left: 8px;
        }

        .ai-indicator.processing {
            color: #f59e0b;
        }

        .error-message {
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .file-disclaimer {
            background-color: #fffbeb;
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Enhanced markdown formatting styles */
        .markdown-content h1 { 
            font-size: 1.875rem; 
            font-weight: 700; 
            margin: 1.5rem 0 1rem 0; 
            color: #1f2937; 
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        .markdown-content h2 { 
            font-size: 1.5rem; 
            font-weight: 600; 
            margin: 1.25rem 0 0.75rem 0; 
            color: #374151; 
        }
        .markdown-content h3 { 
            font-size: 1.25rem; 
            font-weight: 600; 
            margin: 1rem 0 0.5rem 0; 
            color: #4b5563; 
        }
        .markdown-content h4 { 
            font-size: 1.125rem; 
            font-weight: 600; 
            margin: 0.75rem 0 0.5rem 0; 
            color: #6b7280; 
        }
        .markdown-content p { 
            margin: 0.5rem 0; 
        }
        .markdown-content ul, .markdown-content ol { 
            margin: 0.5rem 0; 
            padding-left: 1.5rem; 
        }
        .markdown-content li { 
            margin: 0.25rem 0; 
        }
        .markdown-content strong { 
            font-weight: 600; 
            color: #1f2937; 
        }
        .markdown-content table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 1rem 0; 
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .markdown-content th, .markdown-content td { 
            border: 1px solid #d1d5db; 
            padding: 0.75rem 0.5rem; 
            text-align: left; 
        }
        .markdown-content th { 
            background-color: #f3f4f6; 
            font-weight: 600; 
        }
        .markdown-content tr:nth-child(even) {
            background-color: #f9fafb;
        }
        .markdown-content blockquote { 
            border-left: 4px solid #d1d5db; 
            padding-left: 1rem; 
            margin: 1rem 0; 
            font-style: italic; 
            color: #6b7280; 
        }
        .markdown-content code { 
            background-color: #f3f4f6; 
            padding: 0.125rem 0.25rem; 
            border-radius: 0.25rem; 
            font-family: 'Courier New', monospace; 
            font-size: 0.875rem; 
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Enhanced markdown renderer with proper table handling
        const renderMarkdown = (text) => {
            if (!text) return '';
            
            let processed = text;
            
            // Handle tables first (before line breaks)
            const lines = processed.split('\n');
            let inTable = false;
            let tableLines = [];
            let result = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Check if this is a table row (starts and ends with |)
                if (line.startsWith('|') && line.endsWith('|')) {
                    if (!inTable) {
                        inTable = true;
                        tableLines = [];
                    }
                    tableLines.push(line);
                } else {
                    // If we were in a table, process it
                    if (inTable) {
                        result.push(processTable(tableLines));
                        inTable = false;
                        tableLines = [];
                    }
                    // Add the current line
                    result.push(line);
                }
            }
            
            // Handle any remaining table
            if (inTable && tableLines.length > 0) {
                result.push(processTable(tableLines));
            }
            
            processed = result.join('\n');
            
            // Now apply other markdown formatting
            processed = processed
                // Headers
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^#### (.*$)/gim, '<h4>$1</h4>')
                
                // Bold and italic
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                
                // Lists
                .replace(/^[-*] (.*$)/gim, '<li>$1</li>')
                .replace(/^(\d+)\. (.*$)/gim, '<li>$2</li>')
                
                // Wrap consecutive list items
                .replace(/(<li>.*?<\/li>(?:\s*<li>.*?<\/li>)*)/gs, '<ul>$1</ul>')
                
                // Line breaks
                .replace(/\n/g, '<br>');
            
            return processed;
        };
        
        const processTable = (tableLines) => {
            if (tableLines.length === 0) return '';
            
            // Filter out separator lines (lines with only dashes, spaces, and pipes)
            const contentLines = tableLines.filter(line => 
                !line.match(/^\|[\s\-\|]*\|$/)
            );
            
            if (contentLines.length === 0) return '';
            
            const rows = contentLines.map(line => {
                // Remove leading and trailing pipes, then split by pipes
                const cells = line.slice(1, -1).split('|').map(cell => cell.trim());
                return cells;
            });
            
            if (rows.length === 0) return '';
            
            let tableHtml = '<table>';
            
            // First row as header
            const headerRow = rows[0];
            tableHtml += '<tr>';
            headerRow.forEach(cell => {
                tableHtml += `<th>${cell}</th>`;
            });
            tableHtml += '</tr>';
            
            // Remaining rows as data
            const dataRows = rows.slice(1);
            dataRows.forEach(row => {
                tableHtml += '<tr>';
                row.forEach(cell => {
                    tableHtml += `<td>${cell}</td>`;
                });
                tableHtml += '</tr>';
            });
            
            tableHtml += '</table>';
            return tableHtml;
        };

        function MeetingNotesApp() {
            // State management
            const [files, setFiles] = useState([]);
            const [rawNotes, setRawNotes] = useState('');
            const [summary, setSummary] = useState('');
            const [editableSummary, setEditableSummary] = useState('');
            const [isEditingMode, setIsEditingMode] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [isExtracting, setIsExtracting] = useState(false);
            const [meetingDate, setMeetingDate] = useState('');
            const [meetingTime, setMeetingTime] = useState('');
            const [location, setLocation] = useState('');
            const [meetingTitle, setMeetingTitle] = useState('');
            const [companyAttendees, setCompanyAttendees] = useState('');
            const [clientAttendees, setClientAttendees] = useState('');
            const [client, setClient] = useState(''); // New field
            const [project, setProject] = useState(''); // New field
            const [aiError, setAiError] = useState('');

            // Brain functionality
            const [storedMeetings, setStoredMeetings] = useState([]);
            const [showBrain, setShowBrain] = useState(false);
            const [brainQuery, setBrainQuery] = useState('');
            const [brainResponse, setBrainResponse] = useState('');
            const [isBrainLoading, setIsBrainLoading] = useState(false);
            const [showSaveSuccess, setShowSaveSuccess] = useState(false);
            const [isLoadingMeetings, setIsLoadingMeetings] = useState(false);
            const [saveError, setSaveError] = useState('');

            // API endpoints
            const API_BASE_URL = 'https://meeting-notes-api-watertrace.vercel.app/api';

            useEffect(() => {
                loadMeetingsFromDatabase();
            }, []);

            const loadMeetingsFromDatabase = async () => {
                setIsLoadingMeetings(true);
                try {
                    const response = await fetch(`${API_BASE_URL}/meetings`);
                    if (response.ok) {
                        const meetings = await response.json();
                        const appFormatMeetings = meetings.map(meeting => ({
                            id: meeting.id,
                            date: meeting.meeting_date,
                            time: meeting.meeting_time,
                            venue: meeting.venue,
                            title: meeting.title,
                            companyAttendees: meeting.company_attendees,
                            clientAttendees: meeting.client_attendees,
                            client: meeting.client || '', // New field
                            project: meeting.project || '', // New field
                            rawNotes: meeting.raw_notes,
                            summary: meeting.summary,
                            createdAt: meeting.created_at
                        }));
                        setStoredMeetings(appFormatMeetings);
                    }
                } catch (error) {
                    console.error('Error loading meetings:', error);
                } finally {
                    setIsLoadingMeetings(false);
                }
            };

            const saveMeetingToDatabase = async (meetingRecord) => {
                try {
                    console.log('=== SAVING TO DATABASE ===');
                    
                    // Format exactly like the working test with new fields
                    const payload = {
                        id: meetingRecord.id,
                        title: meetingRecord.title,
                        meeting_date: meetingRecord.date,
                        meeting_time: meetingRecord.time,
                        venue: meetingRecord.venue,
                        company_attendees: meetingRecord.companyAttendees,
                        client_attendees: meetingRecord.clientAttendees,
                        client: meetingRecord.client, // New field
                        project: meetingRecord.project, // New field
                        raw_notes: meetingRecord.rawNotes,
                        summary: meetingRecord.summary,
                        created_at: meetingRecord.createdAt
                    };
                    
                    console.log('Payload to send:', payload);
                    console.log('Summary length:', payload.summary.length);
                    console.log('Raw notes length:', payload.raw_notes.length);
                    
                    const response = await fetch(`${API_BASE_URL}/meetings`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    console.log('Response status:', response.status);
                    
                    const responseText = await response.text();
                    console.log('Response text:', responseText);
                    
                    if (response.ok) {
                        const parsedResponse = JSON.parse(responseText);
                        console.log('✅ Save successful:', parsedResponse);
                        return parsedResponse;
                    } else {
                        console.error('❌ HTTP Error:', response.status);
                        console.error('Error response:', responseText);
                        throw new Error(`Database API returned ${response.status}: ${responseText}`);
                    }
                } catch (error) {
                    console.error('❌ Save error:', error);
                    throw new Error(`Failed to save meeting: ${error.message}`);
                }
            };

            const deleteMeetingFromDatabase = async (id) => {
                try {
                    const response = await fetch(`${API_BASE_URL}/meetings?id=${id}`, {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    throw error;
                }
            };

            const callAI = async (type, content, prompt = '') => {
                try {
                    console.log(`Calling AI with type: ${type}, content length: ${content.length}`);
                    const response = await fetch(`${API_BASE_URL}/ai`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type,
                            content,
                            prompt
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `HTTP ${response.status}`);
                    }

                    const data = await response.json();
                    console.log(`AI response for ${type}:`, data.result);
                    return data.result;
                } catch (error) {
                    console.error('AI API Error:', error);
                    throw error;
                }
            };

            const handleFileUpload = (event) => {
                const uploadedFiles = Array.from(event.target.files);
                
                // Filter for .txt files only
                const txtFiles = uploadedFiles.filter(file => 
                    file.name.toLowerCase().endsWith('.txt') || file.type === 'text/plain'
                );
                
                const rejectedFiles = uploadedFiles.filter(file => 
                    !file.name.toLowerCase().endsWith('.txt') && file.type !== 'text/plain'
                );
                
                if (rejectedFiles.length > 0) {
                    setAiError(`⚠️ Only .txt files are supported. Rejected ${rejectedFiles.length} file(s): ${rejectedFiles.map(f => f.name).join(', ')}`);
                    setTimeout(() => setAiError(''), 8000);
                }
                
                if (txtFiles.length > 0) {
                    setFiles(prev => [...prev, ...txtFiles]);
                    
                    setTimeout(() => {
                        extractFromFilesWithAI(txtFiles);
                    }, 100);
                }
            };

            const removeFile = (index) => {
                setFiles(prev => prev.filter((_, i) => i !== index));
            };

            const extractFromFilesWithAI = async (filesToProcess = files) => {
                if (filesToProcess.length === 0) return;
                
                setIsExtracting(true);
                setAiError('');
                
                try {
                    let extractedContent = '';
                    
                    // Read all files - AI will analyze content, not filename
                    for (const file of filesToProcess) {
                        const text = await readFile(file);
                        extractedContent += text + '\n\n';
                    }
                    
                    setRawNotes(extractedContent);
                    
                    // Use AI to extract meeting details from CONTENT
                    try {
                        const extractedData = await callAI('extract', extractedContent);
                        
                        console.log('AI Extraction Result:', extractedData);
                        
                        if (extractedData && typeof extractedData === 'object') {
                            if (extractedData.title && extractedData.title !== 'null') {
                                setMeetingTitle(extractedData.title);
                            }
                            if (extractedData.date && extractedData.date !== 'null') {
                                setMeetingDate(extractedData.date);
                            }
                            if (extractedData.time && extractedData.time !== 'null') {
                                setMeetingTime(extractedData.time);
                            }
                            if (extractedData.location && extractedData.location !== 'null') {
                                setLocation(extractedData.location);
                            }
                            if (extractedData.attendees && extractedData.attendees !== 'null') {
                                setCompanyAttendees(extractedData.attendees);
                            }
                            // New fields extraction
                            if (extractedData.client && extractedData.client !== 'null') {
                                setClient(extractedData.client);
                            }
                            if (extractedData.project && extractedData.project !== 'null') {
                                setProject(extractedData.project);
                            }
                        }
                        
                    } catch (aiError) {
                        console.error('AI extraction failed:', aiError);
                        setAiError(`AI extraction failed: ${aiError.message}. You can still fill in the details manually.`);
                    }
                    
                } catch (error) {
                    console.error('Error processing files:', error);
                    setAiError(`File processing failed: ${error.message}`);
                } finally {
                    setIsExtracting(false);
                }
            };

            const readFile = (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            };

            const extractFromNotesWithAI = async () => {
                if (!rawNotes.trim()) return;
                
                setIsExtracting(true);
                setAiError('');
                
                try {
                    const extractedData = await callAI('extract', rawNotes);
                    
                    console.log('AI Extraction Result from notes:', extractedData);
                    
                    if (extractedData && typeof extractedData === 'object') {
                        if (extractedData.title && extractedData.title !== 'null') {
                            setMeetingTitle(extractedData.title);
                        }
                        if (extractedData.date && extractedData.date !== 'null') {
                            setMeetingDate(extractedData.date);
                        }
                        if (extractedData.time && extractedData.time !== 'null') {
                            setMeetingTime(extractedData.time);
                        }
                        if (extractedData.location && extractedData.location !== 'null') {
                            setLocation(extractedData.location);
                        }
                        if (extractedData.attendees && extractedData.attendees !== 'null') {
                            setCompanyAttendees(extractedData.attendees);
                        }
                        if (extractedData.client && extractedData.client !== 'null') {
                            setClient(extractedData.client);
                        }
                        if (extractedData.project && extractedData.project !== 'null') {
                            setProject(extractedData.project);
                        }
                    }
                    
                } catch (aiError) {
                    console.error('AI extraction from notes failed:', aiError);
                    setAiError(`AI extraction failed: ${aiError.message}. You can still fill in the details manually.`);
                } finally {
                    setIsExtracting(false);
                }
            };

            const generateSummaryWithAI = async () => {
                if (!rawNotes.trim()) return;
                
                setIsGenerating(true);
                setAiError('');
                
                try {
                    // First, extract meeting details if fields are mostly empty
                    const fieldsEmpty = !meetingTitle && !meetingDate && !client && !project;
                    if (fieldsEmpty) {
                        console.log('Fields mostly empty, extracting details first...');
                        await extractFromNotesWithAI();
                    }
                    
                    const meetingContext = {
                        title: meetingTitle || 'Meeting',
                        date: meetingDate,
                        time: meetingTime,
                        location: location,
                        companyAttendees: companyAttendees,
                        clientAttendees: clientAttendees,
                        client: client, // New field
                        project: project, // New field
                        content: rawNotes
                    };
                    
                    const contextString = `Meeting: ${meetingContext.title}
Date: ${meetingContext.date || 'Not specified'}
Time: ${meetingContext.time || 'Not specified'}
Location: ${meetingContext.location || 'Not specified'}
Client: ${meetingContext.client || 'Not specified'}
Project: ${meetingContext.project || 'Not specified'}
Company Attendees: ${meetingContext.companyAttendees || 'Not specified'}
Client Attendees: ${meetingContext.clientAttendees || 'Not specified'}

Meeting Content:
${meetingContext.content}`;
                    
                    const generatedSummary = await callAI('summarize', contextString);
                    setSummary(generatedSummary);
                    setEditableSummary(generatedSummary);
                    setIsEditingMode(false);
                    
                } catch (error) {
                    console.error('AI summary generation failed:', error);
                    setAiError(`Summary generation failed: ${error.message}. Please try again or create a manual summary.`);
                } finally {
                    setIsGenerating(false);
                }
            };

            const refreshPage = () => {
                window.location.reload();
            };

            const saveToBrain = async () => {
                const summaryToSave = isEditingMode ? editableSummary : summary;
                
                if (!summaryToSave.trim()) {
                    setAiError('No summary to save');
                    return;
                }
                
                setSaveError('');
                setAiError('');
                
                console.log('=== SAVE TO BRAIN CLICKED ===');
                
                // Create meeting record with safe defaults and new fields
                const meetingRecord = {
                    id: Date.now(),
                    date: meetingDate || new Date().toISOString().split('T')[0],
                    time: meetingTime || '00:00',
                    venue: location || '',
                    title: meetingTitle || 'Untitled Meeting',
                    companyAttendees: companyAttendees || '',
                    clientAttendees: clientAttendees || '',
                    client: client || '', // New field
                    project: project || '', // New field
                    rawNotes: rawNotes || '',
                    summary: summaryToSave,
                    createdAt: new Date().toISOString()
                };
                
                console.log('Meeting record prepared:', {
                    id: meetingRecord.id,
                    title: meetingRecord.title,
                    date: meetingRecord.date,
                    client: meetingRecord.client,
                    project: meetingRecord.project,
                    summaryLength: meetingRecord.summary.length,
                    rawNotesLength: meetingRecord.rawNotes.length
                });
                
                try {
                    console.log('Calling saveMeetingToDatabase...');
                    const savedMeeting = await saveMeetingToDatabase(meetingRecord);
                    
                    console.log('✅ Database save completed');
                    
                    // Convert response to app format with new fields
                    const appFormatMeeting = {
                        id: savedMeeting.id,
                        date: savedMeeting.meeting_date,
                        time: savedMeeting.meeting_time,
                        venue: savedMeeting.venue,
                        title: savedMeeting.title,
                        companyAttendees: savedMeeting.company_attendees,
                        clientAttendees: savedMeeting.client_attendees,
                        client: savedMeeting.client || '', // New field
                        project: savedMeeting.project || '', // New field
                        rawNotes: savedMeeting.raw_notes,
                        summary: savedMeeting.summary,
                        createdAt: savedMeeting.created_at
                    };
                    
                    console.log('✅ Adding to stored meetings list');
                    setStoredMeetings(prev => [appFormatMeeting, ...prev]);
                    
                    console.log('✅ Showing success message');
                    setShowSaveSuccess(true);
                    setTimeout(() => setShowSaveSuccess(false), 3000);
                    
                } catch (error) {
                    console.error('❌ Save to brain failed:', error);
                    setSaveError(`Failed to save: ${error.message}`);
                    setAiError(`Save error: ${error.message}`);
                    
                    // Clear error after 10 seconds
                    setTimeout(() => {
                        setSaveError('');
                        setAiError('');
                    }, 10000);
                }
            };

            const deleteMeeting = async (id) => {
                try {
                    await deleteMeetingFromDatabase(id);
                    setStoredMeetings(prev => prev.filter(meeting => meeting.id !== id));
                } catch (error) {
                    setSaveError('Failed to delete meeting. Please try again.');
                    setTimeout(() => setSaveError(''), 5000);
                }
            };

            const exportSummary = () => {
                const summaryToExport = isEditingMode ? editableSummary : summary;
                const meetingInfo = `Meeting: ${meetingTitle || 'Untitled Meeting'}
Date: ${meetingDate || 'Not specified'}
Time: ${meetingTime || 'Not specified'}
Location: ${location || 'Not specified'}
Client: ${client || 'Not specified'}
Project: ${project || 'Not specified'}
Company Attendees: ${companyAttendees || 'Not specified'}
Client Attendees: ${clientAttendees || 'Not specified'}

${summaryToExport}`;

                const blob = new Blob([meetingInfo], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${meetingTitle || 'meeting'}-${meetingDate || new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            const copySummary = async () => {
                const summaryToCopy = isEditingMode ? editableSummary : summary;
                const meetingInfo = `Meeting: ${meetingTitle || 'Untitled Meeting'}
Date: ${meetingDate || 'Not specified'}
Time: ${meetingTime || 'Not specified'}
Location: ${location || 'Not specified'}
Client: ${client || 'Not specified'}
Project: ${project || 'Not specified'}
Company Attendees: ${companyAttendees || 'Not specified'}
Client Attendees: ${clientAttendees || 'Not specified'}

${summaryToCopy}`;

                try {
                    await navigator.clipboard.writeText(meetingInfo);
                    // Show temporary success message
                    const originalText = document.querySelector('.copy-button').textContent;
                    document.querySelector('.copy-button').textContent = '✅ Copied!';
                    setTimeout(() => {
                        const button = document.querySelector('.copy-button');
                        if (button) button.textContent = originalText;
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    setAiError('Failed to copy to clipboard');
                    setTimeout(() => setAiError(''), 3000);
                }
            };

            const handleEditToggle = () => {
                if (isEditingMode) {
                    // Save changes
                    setSummary(editableSummary);
                }
                setIsEditingMode(!isEditingMode);
            };

            const handleEditCancel = () => {
                setEditableSummary(summary);
                setIsEditingMode(false);
            };

            const handleBrainQueryWithAI = async () => {
                if (!brainQuery.trim() || storedMeetings.length === 0) return;

                setIsBrainLoading(true);
                setBrainResponse('');

                try {
                    const response = await fetch(`${API_BASE_URL}/meetings`);
                    let meetingsForQuery = storedMeetings;
                    
                    if (response.ok) {
                        const latestMeetings = await response.json();
                        meetingsForQuery = latestMeetings.map(meeting => ({
                            id: meeting.id,
                            date: meeting.meeting_date,
                            time: meeting.meeting_time,
                            venue: meeting.venue,
                            title: meeting.title,
                            companyAttendees: meeting.company_attendees,
                            clientAttendees: meeting.client_attendees,
                            client: meeting.client || '', // New field
                            project: meeting.project || '', // New field
                            rawNotes: meeting.raw_notes,
                            summary: meeting.summary,
                            createdAt: meeting.created_at
                        }));
                    }

                    const meetingData = meetingsForQuery.map(meeting => 
                        `Meeting: ${meeting.title} (${meeting.date})
Location: ${meeting.venue || 'Not specified'}
Client: ${meeting.client || 'Not specified'}
Project: ${meeting.project || 'Not specified'}
Attendees: ${meeting.companyAttendees || ''} ${meeting.clientAttendees || ''}
Summary: ${meeting.summary}
---`
                    ).join('\n\n');

                    const queryContext = `You have access to ${meetingsForQuery.length} stored meetings. Here's the data:

${meetingData}

User Question: ${brainQuery}`;

                    const aiResponse = await callAI('query', queryContext);
                    setBrainResponse(aiResponse);
                    
                } catch (error) {
                    console.error('Brain query failed:', error);
                    setBrainResponse(`Sorry, I couldn't process your query: ${error.message}. Please try again with a different question.`);
                } finally {
                    setIsBrainLoading(false);
                }
            };

            return (
                <div style={{
                    fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                    backgroundColor: '#f8faf6',
                    minHeight: '100vh',
                    padding: '20px'
                }}>
                    <header style={{
                        maxWidth: '1200px',
                        margin: '0 auto',
                        marginBottom: '32px'
                    }}>
                        <div style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            marginBottom: '20px'
                        }}>
                            <div>
                                <h1 
                                    onClick={refreshPage}
                                    style={{
                                        fontSize: '32px',
                                        fontWeight: '700',
                                        color: '#374528',
                                        margin: '0',
                                        cursor: 'pointer',
                                        transition: 'color 0.2s ease',
                                    }}
                                    onMouseEnter={(e) => e.target.style.color = '#6b7c4e'}
                                    onMouseLeave={(e) => e.target.style.color = '#374528'}
                                    title="Click to refresh page"
                                >
                                    Meeting Notes AI Assistant
                                </h1>
                                <div className="ai-indicator">
                                    🤖 Powered by Google Gemini AI
                                </div>
                            </div>
                            
                            <button
                                onClick={() => setShowBrain(!showBrain)}
                                style={{
                                    padding: '12px 20px',
                                    borderRadius: '8px',
                                    border: '2px solid #374528',
                                    backgroundColor: showBrain ? '#374528' : 'transparent',
                                    color: showBrain ? 'white' : '#374528',
                                    fontSize: '16px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}
                            >
                                🧠 Brain ({storedMeetings.length})
                            </button>
                        </div>
                    </header>

                    <main style={{
                        maxWidth: '1200px',
                        margin: '0 auto'
                    }}>
                        {/* Success/Error Messages */}
                        {showSaveSuccess && (
                            <div style={{
                                backgroundColor: '#d4edda',
                                border: '1px solid #c3e6cb',
                                borderRadius: '8px',
                                padding: '12px',
                                marginBottom: '20px',
                                color: '#155724'
                            }}>
                                ✅ Meeting saved to Brain successfully!
                            </div>
                        )}

                        {saveError && (
                            <div className="error-message">
                                ❌ {saveError}
                            </div>
                        )}

                        {aiError && (
                            <div className="error-message">
                                ⚠️ {aiError}
                            </div>
                        )}

                        {/* TOP GRID: File Upload + Raw Notes */}
                        <div style={{
                            display: 'grid',
                            gridTemplateColumns: '1fr 2fr',
                            gap: '24px',
                            marginBottom: '24px'
                        }}>
                            {/* File Upload Section */}
                            <section style={{
                                backgroundColor: 'white',
                                borderRadius: '12px',
                                padding: '24px',
                                boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                            }}>
                                <h2 style={{
                                    fontSize: '20px',
                                    fontWeight: '600',
                                    marginBottom: '16px',
                                    color: '#374528'
                                }}>
                                    📁 Upload Meeting Files
                                    {isExtracting && (
                                        <span className="ai-indicator processing">
                                            🤖 AI Analyzing Content...
                                        </span>
                                    )}
                                </h2>

                                {/* File format disclaimer */}
                                <div className="file-disclaimer">
                                    <span>⚠️</span>
                                    <div>
                                        <strong>File Format Notice:</strong> Only .txt files are currently supported. 
                                        Other formats (.docx, .pdf, .md) will be rejected.
                                    </div>
                                </div>
                                
                                <div className="custom-file-input">
                                    <input
                                        type="file"
                                        multiple
                                        accept=".txt,text/plain"
                                        onChange={handleFileUpload}
                                        id="file-upload"
                                        disabled={isExtracting}
                                    />
                                    <label htmlFor="file-upload" style={{
                                        display: 'inline-block',
                                        padding: '12px 24px',
                                        backgroundColor: isExtracting ? '#9ca3af' : '#6b7c4e',
                                        color: 'white',
                                        borderRadius: '8px',
                                        cursor: isExtracting ? 'not-allowed' : 'pointer',
                                        fontSize: '14px',
                                        fontWeight: '500'
                                    }}>
                                        {isExtracting ? 'AI Processing...' : 'Choose .txt Files'}
                                    </label>
                                </div>

                                {files.length > 0 && (
                                    <div style={{ marginTop: '16px' }}>
                                        <h3 style={{
                                            fontSize: '16px',
                                            fontWeight: '500',
                                            marginBottom: '8px',
                                            color: '#374528'
                                        }}>
                                            Uploaded Files:
                                        </h3>
                                        <div>
                                            {files.map((file, index) => (
                                                <div key={index} style={{
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    padding: '8px 12px',
                                                    backgroundColor: '#f8faf6',
                                                    borderRadius: '6px',
                                                    marginBottom: '8px'
                                                }}>
                                                    <span style={{ fontSize: '14px', color: '#374528' }}>
                                                        {file.name}
                                                    </span>
                                                    <button
                                                        onClick={() => removeFile(index)}
                                                        style={{
                                                            background: 'none',
                                                            border: 'none',
                                                            color: '#dc3545',
                                                            cursor: 'pointer',
                                                            fontSize: '16px'
                                                        }}
                                                    >
                                                        ✕
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </section>

                            {/* Raw Notes Section */}
                            <section style={{
                                backgroundColor: 'white',
                                borderRadius: '12px',
                                padding: '24px',
                                boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                            }}>
                                <h2 style={{
                                    fontSize: '20px',
                                    fontWeight: '600',
                                    marginBottom: '16px',
                                    color: '#374528'
                                }}>
                                    📝 Meeting Notes
                                    {isExtracting && (
                                        <span className="ai-indicator processing">
                                            🤖 AI Extracting Details...
                                        </span>
                                    )}
                                </h2>
                                <textarea
                                    value={rawNotes}
                                    onChange={(e) => setRawNotes(e.target.value)}
                                    placeholder="Paste your meeting notes here or upload .txt files for AI content analysis..."
                                    style={{
                                        width: '100%',
                                        height: '300px',
                                        padding: '12px',
                                        border: '1px solid #d1d5db',
                                        borderRadius: '8px',
                                        fontSize: '14px',
                                        lineHeight: '1.5',
                                        resize: 'vertical',
                                        fontFamily: 'inherit'
                                    }}
                                />
                                
                                {/* Extract Details Button */}
                                {rawNotes.trim() && !files.length && (
                                    <button
                                        onClick={extractFromNotesWithAI}
                                        disabled={isExtracting}
                                        style={{
                                            marginTop: '12px',
                                            padding: '8px 16px',
                                            backgroundColor: isExtracting ? '#9ca3af' : '#6b7c4e',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '6px',
                                            cursor: isExtracting ? 'not-allowed' : 'pointer',
                                            fontSize: '13px',
                                            fontWeight: '500',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '6px'
                                        }}
                                    >
                                        {isExtracting ? (
                                            <>🤖 Extracting Details...</>
                                        ) : (
                                            <>🔍 Extract Meeting Details</>
                                        )}
                                    </button>
                                )}
                            </section>
                        </div>

                        {/* Meeting Details Section */}
                        <section style={{
                            backgroundColor: 'white',
                            borderRadius: '12px',
                            padding: '24px',
                            boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                            marginBottom: '24px'
                        }}>
                            <h2 style={{
                                fontSize: '20px',
                                fontWeight: '600',
                                marginBottom: '16px',
                                color: '#374528'
                            }}>
                                📅 Meeting Details
                                {(meetingTitle || meetingDate || meetingTime || location || companyAttendees || client || project) && (
                                    <span className="ai-indicator">
                                        🤖 AI Extracted from Content
                                    </span>
                                )}
                            </h2>
                            
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                                gap: '16px'
                            }}>
                                <div>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '4px',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        color: '#374528'
                                    }}>
                                        Meeting Title
                                    </label>
                                    <input
                                        type="text"
                                        value={meetingTitle}
                                        onChange={(e) => setMeetingTitle(e.target.value)}
                                        placeholder="AI will analyze content to extract title"
                                        style={{
                                            width: '100%',
                                            padding: '8px 12px',
                                            border: '1px solid #d1d5db',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>

                                <div>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '4px',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        color: '#374528'
                                    }}>
                                        Client
                                    </label>
                                    <input
                                        type="text"
                                        value={client}
                                        onChange={(e) => setClient(e.target.value)}
                                        placeholder="Client name or organization"
                                        style={{
                                            width: '100%',
                                            padding: '8px 12px',
                                            border: '1px solid #d1d5db',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>

                                <div>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '4px',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        color: '#374528'
                                    }}>
                                        Project
                                    </label>
                                    <input
                                        type="text"
                                        value={project}
                                        onChange={(e) => setProject(e.target.value)}
                                        placeholder="Project name or identifier"
                                        style={{
                                            width: '100%',
                                            padding: '8px 12px',
                                            border: '1px solid #d1d5db',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>
                                
                                <div>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '4px',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        color: '#374528'
                                    }}>
                                        Date
                                    </label>
                                    <input
                                        type="date"
                                        value={meetingDate}
                                        onChange={(e) => setMeetingDate(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '8px 12px',
                                            border: '1px solid #d1d5db',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>
                                
                                <div>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '4px',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        color: '#374528'
                                    }}>
                                        Time
                                    </label>
                                    <input
                                        type="time"
                                        value={meetingTime}
                                        onChange={(e) => setMeetingTime(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '8px 12px',
                                            border: '1px solid #d1d5db',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>
                                
                                <div>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '4px',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        color: '#374528'
                                    }}>
                                        Location
                                    </label>
                                    <input
                                        type="text"
                                        value={location}
                                        onChange={(e) => setLocation(e.target.value)}
                                        placeholder="Meeting location"
                                        style={{
                                            width: '100%',
                                            padding: '8px 12px',
                                            border: '1px solid #d1d5db',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>
                                
                                <div>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '4px',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        color: '#374528'
                                    }}>
                                        Company Attendees
                                    </label>
                                    <input
                                        type="text"
                                        value={companyAttendees}
                                        onChange={(e) => setCompanyAttendees(e.target.value)}
                                        placeholder="Company attendees"
                                        style={{
                                            width: '100%',
                                            padding: '8px 12px',
                                            border: '1px solid #d1d5db',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>
                                
                                <div>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '4px',
                                        fontSize: '14px',
                                        fontWeight: '500',
                                        color: '#374528'
                                    }}>
                                        Client Attendees
                                    </label>
                                    <input
                                        type="text"
                                        value={clientAttendees}
                                        onChange={(e) => setClientAttendees(e.target.value)}
                                        placeholder="Client attendees"
                                        style={{
                                            width: '100%',
                                            padding: '8px 12px',
                                            border: '1px solid #d1d5db',
                                            borderRadius: '6px',
                                            fontSize: '14px'
                                        }}
                                    />
                                </div>
                            </div>
                            
                            <button
                                onClick={generateSummaryWithAI}
                                disabled={!rawNotes.trim() || isGenerating}
                                style={{
                                    marginTop: '20px',
                                    padding: '12px 24px',
                                    backgroundColor: rawNotes.trim() ? '#6b7c4e' : '#9ca3af',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    cursor: rawNotes.trim() && !isGenerating ? 'pointer' : 'not-allowed',
                                    fontSize: '14px',
                                    fontWeight: '500',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}
                            >
                                {isGenerating ? (
                                    <>🤖 AI Generating Summary...</>
                                ) : (
                                    <>🤖 Generate AI Summary</>
                                )}
                            </button>
                        </section>

                        {/* Summary and Brain Grid */}
                        <div style={{
                            display: 'grid',
                            gridTemplateColumns: showBrain ? '2fr 1fr' : '1fr',
                            gap: '24px'
                        }}>
                            {/* Summary Section */}
                            {summary && (
                                <section style={{
                                    backgroundColor: 'white',
                                    borderRadius: '12px',
                                    padding: '24px',
                                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                                }}>
                                    <div style={{
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        marginBottom: '16px'
                                    }}>
                                        <h2 style={{
                                            fontSize: '20px',
                                            fontWeight: '600',
                                            color: '#374528',
                                            margin: '0',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '8px'
                                        }}>
                                            📋 AI-Generated Summary
                                            <span className="ai-indicator">
                                                🤖 Generated by AI
                                            </span>
                                        </h2>
                                        <div style={{ display: 'flex', gap: '8px' }}>
                                            <button
                                                onClick={handleEditToggle}
                                                style={{
                                                    padding: '6px 12px',
                                                    backgroundColor: isEditingMode ? '#28a745' : '#6c757d',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer',
                                                    fontSize: '12px',
                                                    fontWeight: '500'
                                                }}
                                            >
                                                {isEditingMode ? '✅ Save Changes' : '✏️ Edit'}
                                            </button>
                                            {isEditingMode && (
                                                <button
                                                    onClick={handleEditCancel}
                                                    style={{
                                                        padding: '6px 12px',
                                                        backgroundColor: '#dc3545',
                                                        color: 'white',
                                                        border: 'none',
                                                        borderRadius: '4px',
                                                        cursor: 'pointer',
                                                        fontSize: '12px',
                                                        fontWeight: '500'
                                                    }}
                                                >
                                                    ❌ Cancel
                                                </button>
                                            )}
                                        </div>
                                    </div>

                                    {/* Summary Content */}
                                    {isEditingMode ? (
                                        <textarea
                                            value={editableSummary}
                                            onChange={(e) => setEditableSummary(e.target.value)}
                                            style={{
                                                width: '100%',
                                                height: '500px',
                                                padding: '16px',
                                                border: '2px solid #6b7c4e',
                                                borderRadius: '8px',
                                                fontSize: '14px',
                                                lineHeight: '1.6',
                                                resize: 'vertical',
                                                fontFamily: 'inherit',
                                                backgroundColor: '#f8faf6'
                                            }}
                                            placeholder="Edit your meeting summary here..."
                                        />
                                    ) : (
                                        <div 
                                            style={{
                                                padding: '16px',
                                                backgroundColor: '#f8faf6',
                                                borderRadius: '8px',
                                                border: '1px solid #e5e7eb',
                                                fontSize: '14px',
                                                lineHeight: '1.6',
                                                maxHeight: '600px',
                                                overflowY: 'auto'
                                            }}
                                            className="markdown-content"
                                            dangerouslySetInnerHTML={{
                                                __html: renderMarkdown(summary)
                                            }}
                                        />
                                    )}

                                    {/* Action Buttons */}
                                    <div style={{
                                        marginTop: '20px',
                                        display: 'flex',
                                        gap: '12px',
                                        flexWrap: 'wrap',
                                        borderTop: '1px solid #e5e7eb',
                                        paddingTop: '20px'
                                    }}>
                                        <button
                                            onClick={saveToBrain}
                                            disabled={!(isEditingMode ? editableSummary : summary).trim()}
                                            style={{
                                                padding: '12px 20px',
                                                backgroundColor: (isEditingMode ? editableSummary : summary).trim() ? '#6b7c4e' : '#9ca3af',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '8px',
                                                cursor: (isEditingMode ? editableSummary : summary).trim() ? 'pointer' : 'not-allowed',
                                                fontSize: '14px',
                                                fontWeight: '600',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px'
                                            }}
                                        >
                                            🧠 Save to Brain
                                        </button>
                                        
                                        <button
                                            onClick={exportSummary}
                                            disabled={!(isEditingMode ? editableSummary : summary).trim()}
                                            style={{
                                                padding: '12px 20px',
                                                backgroundColor: (isEditingMode ? editableSummary : summary).trim() ? '#17a2b8' : '#9ca3af',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '8px',
                                                cursor: (isEditingMode ? editableSummary : summary).trim() ? 'pointer' : 'not-allowed',
                                                fontSize: '14px',
                                                fontWeight: '500',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px'
                                            }}
                                        >
                                            📥 Export
                                        </button>

                                        <button
                                            onClick={copySummary}
                                            disabled={!(isEditingMode ? editableSummary : summary).trim()}
                                            className="copy-button"
                                            style={{
                                                padding: '12px 20px',
                                                backgroundColor: (isEditingMode ? editableSummary : summary).trim() ? '#28a745' : '#9ca3af',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '8px',
                                                cursor: (isEditingMode ? editableSummary : summary).trim() ? 'pointer' : 'not-allowed',
                                                fontSize: '14px',
                                                fontWeight: '500',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px'
                                            }}
                                        >
                                            📋 Copy
                                        </button>

                                        <button
                                            onClick={refreshPage}
                                            style={{
                                                padding: '12px 20px',
                                                backgroundColor: '#dc3545',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '8px',
                                                cursor: 'pointer',
                                                fontSize: '14px',
                                                fontWeight: '500',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px'
                                            }}
                                        >
                                            🔄 Cancel & Refresh
                                        </button>
                                    </div>
                                </section>
                            )}

                            {/* Brain Panel */}
                            {showBrain && (
                                <div style={{
                                    backgroundColor: 'white',
                                    borderRadius: '12px',
                                    padding: '24px',
                                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                                    height: 'fit-content'
                                }}>
                                    <h2 style={{ 
                                        fontSize: '20px', 
                                        fontWeight: '600', 
                                        marginBottom: '16px',
                                        color: '#374528',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px'
                                    }}>
                                        🧠 AI Meeting Brain
                                        <span className="ai-indicator">
                                            🤖 AI Powered
                                        </span>
                                    </h2>

                                    {/* Query Section */}
                                    <div style={{ marginBottom: '20px' }}>
                                        <label style={{
                                            display: 'block',
                                            marginBottom: '8px',
                                            fontSize: '14px',
                                            fontWeight: '500',
                                            color: '#374528'
                                        }}>
                                            Ask AI about your meetings:
                                        </label>
                                        <div style={{ display: 'flex', gap: '8px' }}>
                                            <input
                                                type="text"
                                                value={brainQuery}
                                                onChange={(e) => setBrainQuery(e.target.value)}
                                                placeholder="e.g., What was discussed about the RFP? Who attended meetings?"
                                                onKeyPress={(e) => e.key === 'Enter' && handleBrainQueryWithAI()}
                                                style={{
                                                    flex: 1,
                                                    padding: '8px 12px',
                                                    border: '1px solid #d1d5db',
                                                    borderRadius: '6px',
                                                    fontSize: '14px'
                                                }}
                                            />
                                            <button
                                                onClick={handleBrainQueryWithAI}
                                                disabled={!brainQuery.trim() || storedMeetings.length === 0 || isBrainLoading}
                                                style={{
                                                    padding: '8px 16px',
                                                    backgroundColor: (brainQuery.trim() && storedMeetings.length > 0) ? '#6b7c4e' : '#9ca3af',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '6px',
                                                    cursor: (brainQuery.trim() && storedMeetings.length > 0) ? 'pointer' : 'not-allowed',
                                                    fontSize: '14px',
                                                   fontWeight: '500'
                                               }}
                                           >
                                               {isBrainLoading ? '🤖' : '🔍'}
                                           </button>
                                       </div>
                                       
                                       {/* Quick query suggestions */}
                                       {storedMeetings.length > 0 && (
                                           <div style={{ marginTop: '8px' }}>
                                               <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>
                                                   Quick questions:
                                               </div>
                                               <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}>
                                                   {[
                                                       'What action items were discussed?',
                                                       'Which clients are we working with?',
                                                       'What projects are active?',
                                                       'Who attended recent meetings?',
                                                       'What decisions were made?',
                                                       'What are the next steps?'
                                                   ].map((suggestion, index) => (
                                                       <button
                                                           key={index}
                                                           onClick={() => setBrainQuery(suggestion)}
                                                           style={{
                                                               padding: '4px 8px',
                                                               fontSize: '11px',
                                                               backgroundColor: '#f3f4f6',
                                                               border: '1px solid #e5e7eb',
                                                               borderRadius: '4px',
                                                               cursor: 'pointer',
                                                               color: '#374528'
                                                           }}
                                                       >
                                                           {suggestion}
                                                       </button>
                                                   ))}
                                               </div>
                                           </div>
                                       )}
                                   </div>

                                   {/* Response Section */}
                                   {brainResponse && (
                                       <div style={{
                                           padding: '12px',
                                           backgroundColor: '#f8faf6',
                                           borderRadius: '8px',
                                           marginBottom: '20px',
                                           border: '1px solid #e5e7eb'
                                       }}>
                                           <h4 style={{
                                               fontSize: '14px',
                                               fontWeight: '600',
                                               marginBottom: '8px',
                                               color: '#374528',
                                               display: 'flex',
                                               alignItems: 'center',
                                               gap: '4px'
                                           }}>
                                               🤖 AI Response:
                                           </h4>
                                           <div 
                                               style={{
                                                   fontSize: '14px',
                                                   lineHeight: '1.5'
                                               }}
                                               className="markdown-content"
                                               dangerouslySetInnerHTML={{
                                                   __html: renderMarkdown(brainResponse)
                                               }}
                                           />
                                       </div>
                                   )}

                                   {isBrainLoading && (
                                       <div style={{
                                           padding: '20px',
                                           textAlign: 'center',
                                           color: '#6b7280',
                                           backgroundColor: '#f8faf6',
                                           borderRadius: '8px',
                                           marginBottom: '20px'
                                       }}>
                                           🤖 AI is analyzing your meetings...
                                       </div>
                                   )}

                                   {/* Stored Meetings List */}
                                   <div>
                                       <h3 style={{
                                           fontSize: '16px',
                                           fontWeight: '600',
                                           marginBottom: '12px',
                                           color: '#374528'
                                       }}>
                                           Stored Meetings ({storedMeetings.length})
                                       </h3>
                                       
                                       {isLoadingMeetings ? (
                                           <div style={{ textAlign: 'center', padding: '20px' }}>
                                               <div>🔄 Loading meetings...</div>
                                           </div>
                                       ) : storedMeetings.length === 0 ? (
                                           <div style={{
                                               textAlign: 'center',
                                               padding: '20px',
                                               color: '#6b7280',
                                               fontSize: '14px'
                                           }}>
                                               No meetings stored yet. Generate and save an AI summary to get started!
                                           </div>
                                       ) : (
                                           <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                                               {storedMeetings.map((meeting) => (
                                                   <div key={meeting.id} style={{
                                                       padding: '12px',
                                                       backgroundColor: '#f8faf6',
                                                       borderRadius: '8px',
                                                       marginBottom: '8px',
                                                       border: '1px solid #e5e7eb'
                                                   }}>
                                                       <div style={{
                                                           display: 'flex',
                                                           justifyContent: 'space-between',
                                                           alignItems: 'flex-start',
                                                           marginBottom: '8px'
                                                       }}>
                                                           <div>
                                                               <h4 style={{
                                                                   fontSize: '14px',
                                                                   fontWeight: '600',
                                                                   margin: '0 0 4px 0',
                                                                   color: '#374528'
                                                               }}>
                                                                   {meeting.title}
                                                               </h4>
                                                               <div style={{
                                                                   fontSize: '12px',
                                                                   color: '#6b7280'
                                                               }}>
                                                                   📅 {meeting.date} {meeting.time && `at ${meeting.time}`}
                                                                   {meeting.venue && ` • 📍 ${meeting.venue}`}
                                                               </div>
                                                               {(meeting.client || meeting.project) && (
                                                                   <div style={{
                                                                       fontSize: '12px',
                                                                       color: '#6b7280',
                                                                       marginTop: '2px'
                                                                   }}>
                                                                       {meeting.client && `🏢 ${meeting.client}`}
                                                                       {meeting.client && meeting.project && ' • '}
                                                                       {meeting.project && `📁 ${meeting.project}`}
                                                                   </div>
                                                               )}
                                                           </div>
                                                           <button
                                                               onClick={() => deleteMeeting(meeting.id)}
                                                               style={{
                                                                   background: 'none',
                                                                   border: 'none',
                                                                   color: '#dc3545',
                                                                   cursor: 'pointer',
                                                                   fontSize: '14px',
                                                                   padding: '4px'
                                                               }}
                                                               title="Delete meeting"
                                                           >
                                                               🗑️
                                                           </button>
                                                       </div>
                                                       {(meeting.companyAttendees || meeting.clientAttendees) && (
                                                           <div style={{
                                                               fontSize: '12px',
                                                               color: '#6b7280',
                                                               marginBottom: '8px'
                                                           }}>
                                                               {meeting.companyAttendees && `👥 ${meeting.companyAttendees}`}
                                                               {meeting.companyAttendees && meeting.clientAttendees && ' • '}
                                                               {meeting.clientAttendees && `🤝 ${meeting.clientAttendees}`}
                                                           </div>
                                                       )}
                                                       <div style={{
                                                           fontSize: '12px',
                                                           color: '#374528',
                                                           maxHeight: '60px',
                                                           overflow: 'hidden',
                                                           textOverflow: 'ellipsis'
                                                       }}>
                                                           {meeting.summary.substring(0, 150)}...
                                                       </div>
                                                   </div>
                                               ))}
                                           </div>
                                       )}
                                   </div>
                               </div>
                           )}
                       </div>
                   </main>
               </div>
           );
       }

       ReactDOM.render(<MeetingNotesApp />, document.getElementById('root'));
   </script>
</body>
</html>
